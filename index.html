<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>COUNT RAID â€“ à¸«à¸¥à¸±à¸à¸à¸²à¸£à¸™à¸±à¸š</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  background:#000;
  color:#eaffff;
  font-family:system-ui,sans-serif;
  text-align:center;
}
.card{
  background:#0b0b0b;
  border:1px solid #00ffcc;
  box-shadow:0 0 20px #00ffcc55;
  padding:20px;
  border-radius:16px;
  max-width:420px;
  margin:20px auto;
}
input,button{
  width:100%;
  padding:12px;
  margin:6px 0;
  border-radius:10px;
  border:none;
  font-size:16px;
}
input{background:#111;color:#fff}
button{
  background:#00ffcc;
  color:#000;
  font-weight:bold;
}
.hidden{display:none}
.scoreRow{
  display:flex;
  justify-content:space-between;
}
</style>
</head>

<body>

<h1>ğŸ® COUNT RAID</h1>
<p>ğŸ§  à¹€à¸à¸¡à¸«à¸¥à¸±à¸à¸à¸²à¸£à¸™à¸±à¸šà¸„à¸“à¸´à¸•à¸¨à¸²à¸ªà¸•à¸£à¹Œ</p>

<div class="card" id="lobby">
  <input id="playerName" placeholder="à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹€à¸¥à¹ˆà¸™">
  <input id="roomInput" placeholder="à¸£à¸«à¸±à¸ªà¸«à¹‰à¸­à¸‡ (à¹€à¸§à¹‰à¸™à¸§à¹ˆà¸²à¸‡à¹€à¸à¸·à¹ˆà¸­à¸ªà¸¸à¹ˆà¸¡)">
  <button onclick="createRoom()">â• à¸ªà¸£à¹‰à¸²à¸‡à¸«à¹‰à¸­à¸‡</button>
  <button onclick="joinRoom()">â¡ï¸ à¹€à¸‚à¹‰à¸²à¸«à¹‰à¸­à¸‡</button>
  <div id="roomCode"></div>
</div>

<div class="card hidden" id="waiting">
  <h2>â³ à¸£à¸­à¹€à¸à¸·à¹ˆà¸­à¸™à¹€à¸‚à¹‰à¸²à¸«à¹‰à¸­à¸‡</h2>
  <p id="waitingRoomCode"></p>
  <div id="playerList"></div>
  <button id="startBtn" class="hidden" onclick="startGame()">â–¶ï¸ à¹€à¸£à¸´à¹ˆà¸¡à¹€à¸à¸¡</button>
</div>

<div class="card hidden" id="game">
  <h3 id="question"></h3>
  <input id="answerInput" placeholder="à¸à¸´à¸¡à¸à¹Œà¸„à¸³à¸•à¸­à¸šà¹€à¸›à¹‡à¸™à¸•à¸±à¸§à¹€à¸¥à¸‚">
  <button onclick="submitAnswer()">à¸ªà¹ˆà¸‡à¸„à¸³à¸•à¸­à¸š</button>
  <p id="result"></p>

  <button id="restartBtn" class="hidden" onclick="restartGame()">ğŸ”„ à¹€à¸£à¸´à¹ˆà¸¡à¹ƒà¸«à¸¡à¹ˆ</button>

  <h3>ğŸ† à¸„à¸°à¹à¸™à¸™</h3>
  <div id="scoreBoard"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getDatabase, ref, set, update, onValue, get }
from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAScwLSlNF1i0cAAT-xadJTFOgGUEsIilk",
  authDomain: "count-raid-game.firebaseapp.com",
  databaseURL: "https://count-raid-game-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "count-raid-game"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* ===== STATE ===== */
let roomCode="", playerId="", playerName="";

/* ===== QUESTIONS (15 à¸‚à¹‰à¸­) ===== */
const questions = [
  { q:"à¸¡à¸µà¹€à¸ªà¸·à¹‰à¸­ 3 à¸•à¸±à¸§ à¹à¸¥à¸°à¸à¸²à¸‡à¹€à¸à¸‡ 2 à¸•à¸±à¸§ à¹à¸•à¹ˆà¸‡à¸•à¸±à¸§à¹„à¸”à¹‰à¸à¸µà¹ˆà¹à¸šà¸š", a:6 },
  { q:"à¹€à¸£à¸µà¸¢à¸‡à¸•à¸±à¸§à¸­à¸±à¸à¸©à¸£ A B C à¹„à¸”à¹‰à¸à¸µà¹ˆà¹à¸šà¸š", a:6 },
  { q:"à¹€à¸¥à¸·à¸­à¸à¸«à¸¡à¸§à¸ 2 à¹ƒà¸š à¸ˆà¸²à¸ 4 à¹ƒà¸š (à¹„à¸¡à¹ˆà¹€à¸£à¸µà¸¢à¸‡à¸¥à¸³à¸”à¸±à¸š)", a:6 },
  { q:"à¹€à¸¥à¸·à¸­à¸à¸œà¸¥à¹„à¸¡à¹‰ 1 à¸­à¸¢à¹ˆà¸²à¸‡ à¸ˆà¸²à¸ 3 à¸­à¸¢à¹ˆà¸²à¸‡", a:3 },
  { q:"à¸¡à¸µà¸—à¸²à¸‡à¹€à¸‚à¹‰à¸² 2 à¸—à¸²à¸‡ à¹à¸¥à¸°à¸—à¸²à¸‡à¸­à¸­à¸ 3 à¸—à¸²à¸‡ à¹€à¸”à¸´à¸™à¹„à¸”à¹‰à¸à¸µà¹ˆà¸§à¸´à¸˜à¸µ", a:6 },

  { q:"à¸¡à¸µà¸£à¸­à¸‡à¹€à¸—à¹‰à¸² 4 à¸„à¸¹à¹ˆ à¹à¸¥à¸°à¸–à¸¸à¸‡à¹€à¸—à¹‰à¸² 3 à¸„à¸¹à¹ˆ à¹€à¸¥à¸·à¸­à¸à¹ƒà¸ªà¹ˆà¹„à¸”à¹‰à¸à¸µà¹ˆà¹à¸šà¸š", a:12 },
  { q:"à¹€à¸¥à¸·à¸­à¸à¸•à¸±à¸§à¹€à¸¥à¸‚ 1 à¸«à¸¥à¸±à¸ à¸ˆà¸²à¸ 0â€“9 à¹„à¸”à¹‰à¸à¸µà¹ˆà¹à¸šà¸š", a:10 },
  { q:"à¹€à¸¥à¸·à¸­à¸à¸™à¸±à¸à¹€à¸£à¸µà¸¢à¸™ 2 à¸„à¸™ à¸ˆà¸²à¸ 5 à¸„à¸™ (à¹„à¸¡à¹ˆà¹€à¸£à¸µà¸¢à¸‡à¸¥à¸³à¸”à¸±à¸š)", a:10 },
  { q:"à¹‚à¸¢à¸™à¹€à¸«à¸£à¸µà¸¢à¸ 2 à¹€à¸«à¸£à¸µà¸¢à¸ à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œà¸¡à¸µà¸à¸µà¹ˆà¹à¸šà¸š", a:4 },
  { q:"à¹‚à¸¢à¸™à¸¥à¸¹à¸à¹€à¸•à¹‹à¸² 1 à¸¥à¸¹à¸ à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œà¸¡à¸µà¸à¸µà¹ˆà¹à¸šà¸š", a:6 },
  { q:"à¹€à¸¥à¸·à¸­à¸à¸­à¸²à¸«à¸²à¸£à¸ˆà¸²à¸ 3 à¸£à¹‰à¸²à¸™ à¸£à¹‰à¸²à¸™à¸¥à¸° 3 à¹€à¸¡à¸™à¸¹ à¹„à¸”à¹‰à¸à¸µà¹ˆà¹à¸šà¸š", a:27 },
  { q:"à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™à¹€à¸›à¹‡à¸™à¸•à¸±à¸§à¹€à¸¥à¸‚ 2 à¸«à¸¥à¸±à¸ (à¸‹à¹‰à¸³à¹„à¸”à¹‰) à¸¡à¸µà¸à¸µà¹ˆà¹à¸šà¸š", a:100 },
  { q:"à¹€à¸¥à¸·à¸­à¸à¸«à¸™à¸±à¸‡à¸ªà¸·à¸­ 1 à¹€à¸¥à¹ˆà¸¡ à¸ˆà¸²à¸ 8 à¹€à¸¥à¹ˆà¸¡", a:8 },
  { q:"à¸ˆà¸²à¸ A à¹„à¸› B à¸¡à¸µ 2 à¸—à¸²à¸‡ à¸ˆà¸²à¸ B à¹„à¸› C à¸¡à¸µ 4 à¸—à¸²à¸‡ à¹„à¸› Aâ†’C à¹„à¸”à¹‰à¸à¸µà¹ˆà¸§à¸´à¸˜à¸µ", a:8 },
  { q:"à¹€à¸¥à¸·à¸­à¸à¹€à¸ªà¸·à¹‰à¸­ 2 à¸•à¸±à¸§ à¸ˆà¸²à¸ 5 à¸•à¸±à¸§ (à¹„à¸¡à¹ˆà¹€à¸£à¸µà¸¢à¸‡à¸¥à¸³à¸”à¸±à¸š)", a:10 }
];

/* ===== ROOM / GAME LOGIC (à¹€à¸«à¸¡à¸·à¸­à¸™à¹€à¸”à¸´à¸¡) ===== */
function randomRoom(){ return Math.random().toString(36).substring(2,6).toUpperCase(); }

window.createRoom = async ()=>{
  playerName = playerNameInput.value.trim();
  if(!playerName) return alert("à¹ƒà¸ªà¹ˆà¸Šà¸·à¹ˆà¸­à¸à¹ˆà¸­à¸™");
  roomCode = roomInput.value || randomRoom();
  playerId = Date.now().toString();
  await set(ref(db,"rooms/"+roomCode),{
    host:playerId, started:false, questionIndex:0, players:{}
  });
  joinRoom(true);
};

window.joinRoom = async (host=false)=>{
  playerName = playerNameInput.value.trim();
  if(!playerName) return alert("à¹ƒà¸ªà¹ˆà¸Šà¸·à¹ˆà¸­à¸à¹ˆà¸­à¸™");
  if(!host){ roomCode = roomInput.value.toUpperCase(); playerId = Date.now().toString(); }
  const roomRef = ref(db,"rooms/"+roomCode);
  const snap = await get(roomRef);
  if(!snap.exists()) return alert("à¹„à¸¡à¹ˆà¸à¸šà¸«à¹‰à¸­à¸‡");
  await update(ref(db,"rooms/"+roomCode+"/players/"+playerId),{name:playerName,score:0});
  lobby.classList.add("hidden"); waiting.classList.remove("hidden");
  onValue(roomRef,(s)=>{
    const d=s.val();
    renderPlayers(d.players);
    if(playerId===d.host) startBtn.classList.remove("hidden");
    if(d.started) loadQuestion(d);
  });
};

function renderPlayers(p){
  playerList.innerHTML="";
  Object.values(p||{}).forEach(x=>playerList.innerHTML+=`<div>${x.name}</div>`);
}

window.startGame = async ()=>{
  await update(ref(db,"rooms/"+roomCode),{started:true,questionIndex:0});
};

function loadQuestion(d){
  waiting.classList.add("hidden"); game.classList.remove("hidden");
  if(d.questionIndex>=questions.length){
    questionEl.innerText="ğŸ‰ à¸ˆà¸šà¹€à¸à¸¡à¹à¸¥à¹‰à¸§";
    restartBtn.classList.remove("hidden");
    renderScores(d.players); return;
  }
  questionEl.innerText=questions[d.questionIndex].q;
  result.innerText=""; answerInput.value=""; answerInput.disabled=false;
  renderScores(d.players);
}

window.submitAnswer = async ()=>{
  const v=parseInt(answerInput.value); if(isNaN(v))return;
  const roomRef=ref(db,"rooms/"+roomCode);
  const d=(await get(roomRef)).val();
  const q=questions[d.questionIndex];
  let delta = v===q.a ? 10 : -5;
  result.innerText = v===q.a ? "âœ… à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡" : "âŒ à¸œà¸´à¸” à¹€à¸‰à¸¥à¸¢ "+q.a;
  const pRef=ref(db,"rooms/"+roomCode+"/players/"+playerId);
  const p=(await get(pRef)).val();
  await update(pRef,{score:(p.score||0)+delta});
  answerInput.disabled=true;
  if(playerId===d.host){
    setTimeout(()=>update(roomRef,{questionIndex:d.questionIndex+1}),1500);
  }
};

window.restartGame = ()=>location.reload();

function renderScores(p){
  scoreBoard.innerHTML="";
  Object.values(p||{}).forEach(x=>scoreBoard.innerHTML+=`<div class="scoreRow"><span>${x.name}</span><b>${x.score}</b></div>`);
}
</script>
</body>
</html>
